<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recetas de Cocina Latinoamericanas</title>
    <link rel="icon" href="/static/img/favicon.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/styles.css" />
    <!-- <script src="/static/js/validar_receta.js"></script> -->
</head>
<body>
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="/"><img src="/static/img/rcl_logo.png" alt="Recetas de Cocina Latinoamericana"></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
                <a class="nav-link" href="/"><h6>Inicio</h6></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/recetas.html"><h6>Recetas</h6></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/recetas_alta.html"><h6 id="active">Tu receta</h6></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/contactenos.html"><h6>Contáctenos</h6></a>
            </li>
            </ul>
            <div class="navbar_usuarios">
            <a href="/login.html"><i class="fas fa-user"></i></a>
            </div>
        </div>
        </nav>
    </div>
    <hr>
    <div class="container-fluid">
        <form id="form_receta" enctype="multipart/form-data">
            <div class="row justify-content-md-center" id="receta">
            </div>
            <div class="botones_btn">
                <button type="submit" class="btn btn_success">Modificar receta</button>
                <button type="reset" class="btn btn_danger">Borrar datos</button>
            </div>
        </form>
    </div>
    <hr>
    <footer class="row text-center">
      <div class="col">
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3285.9400576393878!2d-58.48387002488747!3d-34.555073054929714!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x95bcb69215b6aaab%3A0xcbe90dc9b728abd8!2sWashington%203664%2C%20C1430EUX%20Cdad.%20Aut%C3%B3noma%20de%20Buenos%20Aires!5e0!3m2!1ses-419!2sar!4v1715733263422!5m2!1ses-419!2sar" width="350" height="200" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
      <div class="col">
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-instagram-square"></i></a>
          <a href="#"><i class="fab fa-whatsapp-square"></i></a>
          <a href="#"><i class="fas fa-envelope"></i></a>
      </div>
      <hr>
      <h6><i class="fas fa-copyright copyright"></i>Copyright 2024 Recetas de Cocina Latinoamericana</h6>
    </footer>
    <script>
        //Al subir al servidor, deberá utilizarse la siguiente ruta. USUARIO debe ser reemplazado por el nombre
        //de usuario de Pythonanywhere //const URL = "https://USUARIO.pythonanywhere.com/"
        //Capturamos el evento de envío del formulario
        // Obtener la URL actual
        var url = window.location.href;
        // Crear un objeto URL
        var urlParams = new URLSearchParams(window.location.search);
        // Obtener el valor del parámetro 'nombre'
        var receta = urlParams.get('receta');
        const URL = "http://127.0.0.1:5000"
        // Ejemplo de uso de los parámetros
        fetch(URL + "/recetas/" + receta)
        .then(function (response) { 
              if (response.ok) {
                  //Si la respuesta es exitosa (response.ok), convierte el cuerpo de la respuesta de formato
                  //JSON a un objeto JavaScript y pasa estos datos a la siguiente promesa then.
                  return response.json(); }
              else {
                  //Si hubo un error, lanzar explícitamente una excepción para ser "catcheada" más adelante
                  throw new Error('Error al obtener las recetas.'); } })
              //Esta función maneja los datos convertidos del JSON.
          .then(function (data) { 
                let receta = document.getElementById('receta');
                //Selecciona el elemento del DOM donde se mostrarán los productos.
                // Iteramos sobre cada producto y agregamos filas a la tabla
                    let fila = document.createElement('div');
                    fila.className = "row justify-content-md-center";
                    //Crea una nueva fila de tabla (<tr>) para cada producto.
                    fila.innerHTML = 
                    '<div class="col col-lg-8 receta">' +
                    '<h4>Modificá tu receta: </h4>' +
                    '<div class="input-group">' +
                        '<span class="input-group-text" id="addon-wrapping">Nombre de la receta: </span>' +
                        '<input type="text" class="form-control"aria-label="Username" aria-describedby="addon-wrapping" name="nombre" id="nombre" value= "' + data.nombre + '">' +
                    '</div>' +
                    '<h6 id="msg_nombre"></h6>' +
                    '<div class="input-group">' +
                        '<label class="input-group-text" for="pais_origen">País de origen: </label>' +
                        '<select class="form-select" id="pais_origen" name="pais_origen">' +
                            '<option selected>' + data.pais_origen + '</option>' +
                            '<option value="Argentina">Argentina</option>' +
                            '<option value="Bélice">Bélice</option>' +
                            '<option value="Bolivia">Bolivia</option>' +
                            '<option value="Brasil">Brasil</option>' +
                            '<option value="Chile">Chile</option>' +
                            '<option value="Colombia">Colombia</option>' +
                            '<option value="Costa rica">Costa Rica</option>' +
                            '<option value="Cuba">Cuba</option>' +
                            '<option value="Ecuador">Ecuador</option>' +
                            '<option value="El Salvador">El Salvador</option>' +                            '<option value="Guatemala">Guatemala</option>'  +
                            '<option value="Haiti">Haiti</option>' +
                            '<option value="Honduras">Honduras</option>' +
                            '<option value="Mexico">Mexico</option>' +
                            '<option value="Nicaragua">Nicaragua</option>' +
                            '<option value="Panamá">Panama</option>' +
                            '<option value="Paraguay">Paraguay</option>' +
                            '<option value="Peru">Peru</option>' +
                            '<option value="Puerto rico">Puerto Rico</option>' +
                            '<option value="Republica dominicana">Republica Dominicana</option>' +
                            '<option value="Uruguay">Uruguay</option>' +
                            '<option value="Venezuela">Venezuela</option>' +
                        '</select>' +
                    '</div>' +
                    '<h6 id="msg_pais_origen"></h6>' +
                    '<div class="mb-3">' +
                        '<label for="imagen" class="form-label" id="imagen_label">Imagen: ' + data.imagen + '</label>' +
                        '<input class="form-control" type="file" id="imagen" name="imagen">' +
                        '<h6 id="msg_imagen"></h6>' +
                    '</div>' +
                    '<div class="input-group">' +
                        '<label class="input-group-text" for="tipo">Tipo de plato: </label>' +
                        '<select class="form-select" id="tipo" name="tipo">' +
                        '<option selected>' + data.tipo + '</option>' +
                        '<option value="Entrada fría">Entrada fría</option>' +
                        '<option value="Entrada caliente">Entrada caliente</option>' +
                        '<option value="Plato principal">Plato principal</option>' +
                        '<option value="Postre">Postre</option>' +
                        '</select>' +
                    '</div>' +
                    '<h6 id="msg_tipo"></h6>' +
                    '<div class="input-group">' +
                        '<label class="input-group-text" for="tipo_alimentacion">Tipo de alimentación: </label>' +
                        '<select class="form-select" id="tipo_alimentacion" name="tipo_alimentacion">' +
                        '<option selected>' + data.tipo_alimentacion + '</option>' +
                        '<option value="Sin particularidades">Sin particularidades</option>' +
                        '<option value="Gluten Free">Gluten Free</option>' +
                        '<option value="Vegetariano">Vegetariano</option>' +
                        '<option value="Vegano">Vegano</option>' +
                        '</select>' +
                    '</div>' +
                    '<h6 id="msg_tipo_alimentacion"></h6>' +
                    '<div class="input-group">' +
                        '<label class="input-group-text" for="tiempo_coccion">Tiempo de preparación: </label>' +
                        '<select class="form-select" id="tiempo_coccion" name="tiempo_coccion">' +
                        '<option selected>' + data.tiempo_coccion + '</option>' +
                        '<option value="Rápida (menos de 30 minutos)">Rápida (menos de 30 minutos)</option>' +
                        '<option value="Media (aproximadamente 1 hora)">Media (aproximadamente 1 hora)</option>' +
                        '<option value="Prolongada (1 hora o más)">Prolongada (1 hora o más)</option>' +
                        '</select>' +
                    '</div>' +
                    '<h6 id="msg_tiempo_coccion"></h6>' +
                    '<div class="input-group">' +
                        '<label class="input-group-text" for="destaca">Destacada en la portada?: </label>' +
                        '<select class="form-select" id="destacada" name="destacada">' +
                        '<option selected>' + data.destacada + '</option>' +
                        '<option value="1">Sí</option>' +
                        '<option value="2">No</option>' +
                        '</select>' +
                    '</div>' +
                    '<h6 id="msg_destacada"></h6>' +
                    '<div class="input-group">' +
                        '<span class="input-group-text">Ingredientes:</span>' +
                        '<textarea class="form-control" aria-label="With textarea" name="ingredientes" id="ingredientes">' + data.ingredientes + '</textarea>' +
                    '</div>' +
                    '<h6 id="msg_ingredientes"></h6>' +
                    '<div class="input-group">' +
                        '<span class="input-group-text">Preparación:</span>' +
                        '<textarea class="form-control" aria-label="With textarea" name="preparacion" id="preparacion">' + data.preparacion + '</textarea>' +
                    '</div>' +
                    '<h6 id="msg_preparacion"></h6>' +
                '</div>'
                    receta.appendChild(fila);
              })

        /////////////////////////////////////////////////////////////
        document.getElementById('form_receta').addEventListener('submit', function (event) {
            event.preventDefault(); // Evitamos que se envie el form var
            var msg_nombre = document.getElementById('msg_nombre');
            var msg_pais_origen = document.getElementById('msg_pais_origen');
            var msg_imagen = document.getElementById('msg_imagen');
            var msg_tipo = document.getElementById('msg_tipo');
            var msg_tipo_alimentacion = document.getElementById('msg_tipo_alimentacion');
            var msg_tiempo_coccion = document.getElementById('msg_tiempo_coccion');
            var msg_destacada = document.getElementById('msg_destacada');
            var msg_ingredientes = document.getElementById('msg_ingredientes');
            var msg_preparacion = document.getElementById('msg_preparacion');

            msg_nombre.innerText = '';
            msg_pais_origen.innerText = '';
            msg_imagen.innerText = '';
            msg_tipo.innerText = '';
            msg_tipo_alimentacion.innerText = '';
            msg_tiempo_coccion.innerText = '';
            msg_destacada.innerText = '';
            msg_ingredientes.innerText = '';
            msg_preparacion.innerText = '';

            if(this.querySelector('[name=nombre]').value == '') {
                msg_nombre.style.visibility = "visible"
                msg_nombre.innerText = 'Debes ingresar el nombre de la receta';
                //return;
            }

            if(this.querySelector('[name=pais_origen]').value == '') {
                msg_pais_origen.style.visibility = "visible"
                msg_pais_origen.innerText = 'Debes ingresar el país de origen';
                //return;
            }

            if(this.querySelector('[name=imagen]').value == '') {
                msg_imagen.style.visibility = "visible"
                msg_imagen.innerText = 'Debes ingresar la imagen de la receta';
                //return;
            }

            if(this.querySelector('[name=tipo]').value == '') {
                msg_tipo.style.visibility = "visible"
                msg_tipo.innerText = 'Debes ingresar el tipo de plato';
                //return;
            }

            if(this.querySelector('[name=tipo_alimentacion]').value == '') {
                msg_tipo_alimentacion.style.visibility = "visible"
                msg_tipo_alimentacion.innerText = 'Debes ingresar el tipo de alimentación';
                //return;
            }

            if(this.querySelector('[name=tiempo_coccion]').value == '') {
                msg_tiempo_coccion.style.visibility = "visible"
                msg_tiempo_coccion.innerText = 'Debes ingresar el tiempo de cocción';
                //return;
            }

            if(this.querySelector('[name=destacada]').value == '') {
                msg_destacada.style.visibility = "visible"
                msg_destacada.innerText = 'Debes indicar si la receta se destaca en la portada o no';
                //return;
            }

            if(this.querySelector('[name=ingredientes]').value == '') {
                msg_ingredientes.style.visibility = "visible"
                msg_ingredientes.innerText = 'Debes indicar los ingredientes de la receta';
                //return;
            }

            if(this.querySelector('[name=preparacion]').value == '') {
                msg_preparacion.style.visibility = "visible"
                msg_preparacion.innerText = 'Debes indicar la preparación de la receta';
                return;
            }

            formData = new FormData(this);
            ruta = URL + '/recetas_modificar/' + receta
            console.log(ruta)
            // Realizamos la solicitud POST al servidor
            fetch(ruta, {
                //method: 'PUT',
                method: 'POST',
                body: formData // Aquí enviamos formData. Dado que formData puede contener archivos, no se utiliza JSON.
            })
            //Después de realizar la solicitud POST, se utiliza el método then() para manejar la respuesta
            //del servidor.
            .then(function (response) {
                if (response.ok) { //Si la respuesta es exitosa, convierte los datos de la respuesta a formato JSON.
                    return response.json();
                }
                else { // Si hubo un error, lanzar explícitamente una excepción // para ser "catcheada" más adelante
                    throw new Error('Error al recuperar la receta.');
                }
            }) //Respuesta OK, muestra una alerta informando que el producto se agregó correctamente y limpia los campos del formulario para que puedan ser utilizados para un nuevo producto.
            .then(function (data) { alert('Receta modificada correctamente.'); })
            // En caso de error, mostramos una alerta con un mensaje de error.
            .catch(function (error) { alert('Error al modificar la receta.'); })
            // Limpiar el formulario en ambos casos (éxito o error)
            .finally(function () {
                location.href = '/recetas_admin.html';
            });
        })
    </script>
</body>